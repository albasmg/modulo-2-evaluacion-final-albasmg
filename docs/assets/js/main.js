"use strict";const searchButton=document.querySelector(".js-searchButton"),resultsContainer=document.querySelector(".js-resultsContainer"),favoritesContainer=document.querySelector(".js-favoritesContainer"),favoritesToggleContainer=document.querySelector(".js-favoritesToggle"),noFavoritesMsg=document.querySelector(".js-noFavoritesMsg");let favoriteSeries=JSON.parse(localStorage.getItem("series"))||[],originalSeries=[];const removeLastSearch=()=>resultsContainer.innerHTML="",addSeriesListeners=()=>{const e=document.querySelectorAll(".series__container");for(const t of e)t.addEventListener("click",handleAddToFavoritesClick)},findSerieInFavorites=e=>favoriteSeries.find(t=>e===t.id),removeSerieInFavorites=e=>favoriteSeries.filter(t=>e!==t.id),handleAddToFavoritesClick=e=>{const t=e.currentTarget.querySelector("img").src,r=e.currentTarget.querySelector(".series__name").innerHTML,s=parseInt(e.currentTarget.id),i={id:s,name:r,image:t};if(findSerieInFavorites(s)){e.currentTarget.classList.toggle("selected"),a=s,favoriteSeries=favoriteSeries.filter(e=>a!==e.id),localStorage.setItem("series",JSON.stringify(favoriteSeries)),favoritesContainer.innerHTML="";for(const e of favoriteSeries)printFavorite(e)}else{e.currentTarget.classList.toggle("selected"),favoriteSeries.push(i),localStorage.setItem("series",JSON.stringify(favoriteSeries));const t=document.querySelector(".fa-heart");t.classList.add("animated-heart"),setTimeout(()=>t.classList.remove("animated-heart"),2e3),printFavorite()}var a;showRemoveAllFavoritesButton()},printFavorite=e=>{const t=e||favoriteSeries[favoriteSeries.length-1],r=document.createElement("div"),s=document.createElement("button"),i=document.createElement("img"),a=document.createElement("p"),o=document.createTextNode(t.name),n=document.createElement("i");favoritesContainer.appendChild(r),r.appendChild(s),r.appendChild(i),r.appendChild(a),a.appendChild(o),s.appendChild(n),i.setAttribute("src",t.image?t.image:"assets/images/no-image.png"),s.setAttribute("class","far fa-trash-alt"),r.classList.add("favorites__container"),i.classList.add("favorites__image"),a.classList.add("favorites__name"),s.classList.add("favorites__removeButton");s.addEventListener("click",()=>{const e=favoriteSeries.filter(e=>e.id!==t.id);localStorage.setItem("series",JSON.stringify(e)),favoritesContainer.innerHTML="",favoriteSeries=e,favoriteSeries.length||(removeAllFavoritesButton.classList.add("hidden"),noFavoritesMsg.classList.remove("hidden")),removeLastSearch(),printResults(originalSeries);for(const t of e)printFavorite(t)})},removeAllFavoritesButton=document.querySelector(".js-removeAllFavoritesButton"),handleRemoveAllFavoritesClick=()=>{favoriteSeries=[],localStorage.removeItem("series"),favoritesContainer.innerHTML="",removeAllFavoritesButton.classList.toggle("hidden"),noFavoritesMsg.classList.remove("hidden"),printResults(originalSeries)};removeAllFavoritesButton.addEventListener("click",handleRemoveAllFavoritesClick);const printResults=e=>{removeLastSearch();for(const t of e){const e=t.show.id,r=t.show.name,s=t.show.image,i=document.createElement("li"),a=document.createElement("img"),o=document.createElement("p"),n=document.createTextNode(r);resultsContainer.appendChild(i),i.appendChild(a),i.appendChild(o),o.appendChild(n),i.setAttribute("id",e),a.setAttribute("src",s?s.medium:"assets/images/no-image.png"),i.classList.add("series__container"),o.classList.add("series__name"),a.classList.add("series__image");findSerieInFavorites(e)&&(i.classList.add("selected"),o.classList.add("selected-name"))}addSeriesListeners()},handleSearchButtonClick=()=>{const e=document.querySelector(".js-searchInput").value,t=document.querySelector(".js-noResultsFoundMsg");if(e)fetch("https://api.tvmaze.com/search/shows?q="+e).then(e=>e.json()).then(e=>{originalSeries=e,e.length?t.classList.add("hidden"):(console.log("entro"),t.classList.remove("hidden")),printResults(e)});else{removeLastSearch(),t.classList.add("hidden");const e=document.createElement("p"),r=document.createTextNode("Para que pueda ayudarte a buscar tus series favoritas, tienes que escribir algo en el buscador 💁🏻‍♀️");resultsContainer.appendChild(e),e.appendChild(r),e.classList.add("error-message")}},searcher=document.querySelector(".js-searchInput");searcher.addEventListener("keyup",(function(e){13===e.keyCode&&handleSearchButtonClick()})),searchButton.addEventListener("click",handleSearchButtonClick);const favoritesToggle=document.querySelector(".favorites__headingContainer"),handleFavoritesToggleClick=()=>{const e=document.querySelector(".fa-chevron-down");favoritesToggleContainer.classList.toggle("hidden"),e.classList.toggle("rotate-arrow")};favoritesToggle.addEventListener("click",handleFavoritesToggleClick);const showRemoveAllFavoritesButton=()=>{favoriteSeries.length&&(removeAllFavoritesButton.classList.remove("hidden"),noFavoritesMsg.classList.add("hidden"))},printFavoriteSeriesOnStart=()=>{for(const e of favoriteSeries)printFavorite(e)};printFavoriteSeriesOnStart(),showRemoveAllFavoritesButton();